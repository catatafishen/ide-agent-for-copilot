"use strict";(()=>{function g(s){let t=atob(s),i=new Uint8Array(t.length);for(let e=0;e<t.length;e++)i[e]=t.codePointAt(e);return new TextDecoder().decode(i)}function h(s,t){s&&s.querySelectorAll("tool-chip, thinking-chip, subagent-chip").forEach(i=>{if(i===t)return;let e=i._linkedSection;!e||e.classList.contains("turn-hidden")||(i.style.opacity="1",e.classList.add("turn-hidden"),e.classList.remove("chip-expanded","collapsing","collapsed"))})}function d(s){return s?s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}var p=class extends HTMLElement{_init=!1;_autoScroll=!0;_messages;_scrollRAF=null;_observer;_copyObs;_prevScrollY=0;_programmaticScroll=!1;connectedCallback(){this._init||(this._init=!0,this._autoScroll=!0,this._messages=document.createElement("div"),this._messages.id="messages",this.appendChild(this._messages),window.addEventListener("scroll",()=>{if(this._programmaticScroll){this._programmaticScroll=!1,this._prevScrollY=window.scrollY;return}window.innerHeight+window.scrollY>=document.body.scrollHeight-40?this._autoScroll=!0:window.scrollY<this._prevScrollY&&(this._autoScroll=!1),this._prevScrollY=window.scrollY}),window.addEventListener("resize",()=>{this._autoScroll&&(this._programmaticScroll=!0,window.scrollTo(0,document.body.scrollHeight))}),this._observer=new MutationObserver(()=>{this._scrollRAF||(this._scrollRAF=requestAnimationFrame(()=>{this._scrollRAF=null,this.scrollIfNeeded()}))}),this._observer.observe(this._messages,{childList:!0,subtree:!0,characterData:!0}),this._copyObs=new MutationObserver(()=>{this._messages.querySelectorAll("pre:not([data-copy-btn]):not(.streaming)").forEach(t=>{t.dataset.copyBtn="1";let i=document.createElement("button");i.className="copy-btn",i.textContent="Copy",i.onclick=()=>{let e=t.querySelector("code");navigator.clipboard.writeText(e?e.textContent:t.textContent).then(()=>{i.textContent="Copied!",setTimeout(()=>i.textContent="Copy",1500)})},t.appendChild(i)})}),this._copyObs.observe(this._messages,{childList:!0,subtree:!0}))}get messages(){return this._messages}scrollIfNeeded(){this._autoScroll&&(this._programmaticScroll=!0,window.scrollTo(0,document.body.scrollHeight))}forceScroll(){this._autoScroll=!0,this._programmaticScroll=!0,window.scrollTo(0,document.body.scrollHeight)}disconnectedCallback(){this._observer?.disconnect(),this._copyObs?.disconnect()}};var _=class extends HTMLElement{static get observedAttributes(){return["type","timestamp"]}_init=!1;connectedCallback(){if(this._init)return;this._init=!0;let t=this.getAttribute("type")||"agent";this.classList.add(t==="user"?"prompt-row":"agent-row")}attributeChangedCallback(t,i,e){t==="type"&&this._init&&(this.classList.remove("prompt-row","agent-row"),this.classList.add(e==="user"?"prompt-row":"agent-row"))}};var b=class extends HTMLElement{static get observedAttributes(){return["streaming","type"]}_init=!1;_pre=null;connectedCallback(){if(this._init)return;this._init=!0;let t=this.closest("chat-message"),i=t?.getAttribute("type")==="user";this.classList.add(i?"prompt-bubble":"agent-bubble"),i&&(this.setAttribute("tabindex","0"),this.setAttribute("role","button"),this.setAttribute("aria-label","Toggle message details")),this.onclick=e=>{if(e.target.closest("a,.turn-chip"))return;h(t);let n=t?.querySelector("message-meta");n&&n.classList.toggle("show")},this.hasAttribute("streaming")&&this._setupStreaming()}_setupStreaming(){this._pre||(this._pre=document.createElement("pre"),this._pre.className="streaming",this.innerHTML="",this.appendChild(this._pre))}appendStreamingText(t){this._pre||this._setupStreaming(),this._pre.textContent+=t}finalize(t){this.removeAttribute("streaming"),this._pre=null,this.innerHTML=t}get content(){return this.innerHTML}attributeChangedCallback(t){t==="streaming"&&this._init&&this.hasAttribute("streaming")&&this._setupStreaming()}};var f=class extends HTMLElement{_init=!1;connectedCallback(){this._init||(this._init=!0,this.classList.add("meta"))}};var v=class extends HTMLElement{_init=!1;connectedCallback(){this._init||(this._init=!0,this.classList.add("thinking-section"),this.innerHTML='<div class="thinking-content"></div>')}get contentEl(){return this.querySelector(".thinking-content")}appendText(t){let i=this.contentEl;i&&(i.textContent+=t)}finalize(){this.removeAttribute("active")}};var y=class extends HTMLElement{_init=!1;connectedCallback(){this._init||(this._init=!0,this.classList.add("tool-section","turn-hidden"),this.innerHTML=`
            <div class="tool-params"></div>
            <div class="tool-result">Running...</div>`)}set params(t){let i=this.querySelector(".tool-params");i&&(i.innerHTML=`<pre class="tool-params-code"><code>${d(t)}</code></pre>`)}set result(t){let i=this.querySelector(".tool-result");i&&(i.innerHTML=t)}updateStatus(t){}};function R(s){let t=s.replace(/^[Ii]ntellij-code-tools-/,"").replace(/^github-mcp-server-/,"gh:");return t.startsWith("gh:")?"github":t.startsWith("git_")?"git":{intellij_read_file:"file",intellij_write_file:"file",create_file:"file",delete_file:"file",open_in_editor:"file",show_diff:"file",undo:"file",search_text:"search",search_symbols:"search",find_references:"search",go_to_declaration:"search",get_file_outline:"search",get_class_outline:"search",get_type_hierarchy:"search",get_documentation:"search",list_project_files:"search",list_tests:"search",format_code:"quality",optimize_imports:"quality",run_inspections:"quality",get_compilation_errors:"quality",get_problems:"quality",get_highlights:"quality",apply_quickfix:"quality",suppress_inspection:"quality",add_to_dictionary:"quality",run_qodana:"quality",run_sonarqube_analysis:"quality",build_project:"build",run_command:"build",run_tests:"build",get_test_results:"build",get_coverage:"build",run_configuration:"build",create_run_configuration:"build",edit_run_configuration:"build",list_run_configurations:"build",get_project_info:"ide",read_ide_log:"ide",get_notifications:"ide",read_run_output:"ide",run_in_terminal:"ide",read_terminal_output:"ide",download_sources:"ide",create_scratch_file:"ide",list_scratch_files:"ide",get_indexing_status:"ide",mark_directory:"ide",get_chat_html:"ide",http_request:"ide",refactor:"ide"}[t]||"default"}function $(s){if(!s)return"";let t=s.replace(/\\/g,"/").split("/");return t[t.length-1]}function u(s,t=24){return s.length>t?s.substring(0,t-1)+"\u2026":s}function I(s){let t=s.lastIndexOf(".");return t>=0?s.substring(t+1):s}function G(s,t){let i=s.replace(/^[Ii]ntellij-code-tools-/,"").replace(/^github-mcp-server-/,"gh:"),e={};if(t)try{e=JSON.parse(t)}catch{}let n=$(e.path||e.file||e.scope||""),o={intellij_read_file:()=>n?`Reading ${n}`:"Reading file",intellij_write_file:()=>n?`Editing ${n}`:"Editing file",create_file:()=>n?`Creating ${n}`:"Creating file",delete_file:()=>n?`Deleting ${n}`:"Deleting file",open_in_editor:()=>n?`Opening ${n}`:"Opening file",show_diff:()=>n?`Diff ${n}`:"Showing diff",undo:()=>n?`Undo in ${n}`:"Undoing",search_text:()=>e.query?`Searching \u201C${u(e.query,20)}\u201D`:"Searching text",search_symbols:()=>e.query?`Finding \u201C${u(e.query,20)}\u201D`:"Finding symbols",find_references:()=>e.symbol?`Refs: ${e.symbol}`:"Finding references",go_to_declaration:()=>e.symbol?`Go to ${e.symbol}`:"Go to declaration",get_file_outline:()=>n?`Outline ${n}`:"File outline",get_class_outline:()=>e.class_name?`Outline ${I(e.class_name)}`:"Class outline",get_type_hierarchy:()=>e.symbol?`Hierarchy: ${e.symbol}`:"Type hierarchy",get_documentation:()=>e.symbol?`Docs: ${u(e.symbol,28)}`:"Getting docs",list_project_files:()=>"Listing files",list_tests:()=>"Listing tests",format_code:()=>n?`Formatting ${n}`:"Formatting code",optimize_imports:()=>n?`Imports ${n}`:"Optimizing imports",run_inspections:()=>n?`Inspecting ${n}`:"Running inspections",get_compilation_errors:()=>"Checking compilation",get_problems:()=>"Getting problems",get_highlights:()=>"Getting highlights",apply_quickfix:()=>"Applying quickfix",suppress_inspection:()=>"Suppressing inspection",add_to_dictionary:()=>e.word?`Adding \u201C${e.word}\u201D to dictionary`:"Adding to dictionary",run_qodana:()=>"Running Qodana",run_sonarqube_analysis:()=>"Running SonarQube",refactor:()=>e.operation==="rename"?`Renaming ${e.symbol||""}`:e.operation?`Refactor: ${e.operation}`:"Refactoring",build_project:()=>"Building project",run_command:()=>e.title?u(e.title,32):e.command?`Running ${u(e.command,24)}`:"Running command",run_tests:()=>e.target?`Testing ${u(e.target,24)}`:"Running tests",get_test_results:()=>"Test results",get_coverage:()=>"Getting coverage",run_configuration:()=>e.name?`Running \u201C${u(e.name,20)}\u201D`:"Running config",create_run_configuration:()=>e.name?`Creating config \u201C${u(e.name,16)}\u201D`:"Creating run config",edit_run_configuration:()=>e.name?`Editing config \u201C${u(e.name,16)}\u201D`:"Editing run config",list_run_configurations:()=>"Listing run configs",git_status:()=>"Git status",git_diff:()=>n?`Git diff ${n}`:"Git diff",git_commit:()=>"Git commit",git_stage:()=>n?`Staging ${n}`:"Git stage",git_unstage:()=>n?`Unstaging ${n}`:"Git unstage",git_log:()=>"Git log",git_blame:()=>n?`Blame ${n}`:"Git blame",git_show:()=>"Git show",git_branch:()=>e.action==="switch"?`Switch to ${e.name}`:e.action==="create"?`Create branch ${e.name}`:"Git branch",git_stash:()=>e.action?`Git stash ${e.action}`:"Git stash",get_project_info:()=>"Project info",read_ide_log:()=>"Reading IDE log",get_notifications:()=>"Getting notifications",read_run_output:()=>"Reading run output",run_in_terminal:()=>"Running in terminal",read_terminal_output:()=>"Reading terminal",download_sources:()=>"Downloading sources",create_scratch_file:()=>e.name?`Scratch: ${e.name}`:"Creating scratch",list_scratch_files:()=>"Listing scratches",get_indexing_status:()=>"Indexing status",mark_directory:()=>"Marking directory",get_chat_html:()=>"Getting chat HTML",http_request:()=>e.url?`${e.method||"GET"} ${u(e.url,28)}`:"HTTP request","gh:get_file_contents":()=>e.path?`GH: ${$(e.path)}`:"GH: get file","gh:search_code":()=>"GH: search code","gh:search_repositories":()=>"GH: search repos","gh:search_issues":()=>"GH: search issues","gh:search_pull_requests":()=>"GH: search PRs","gh:search_users":()=>"GH: search users","gh:list_issues":()=>"GH: list issues","gh:list_pull_requests":()=>"GH: list PRs","gh:list_commits":()=>"GH: list commits","gh:list_branches":()=>"GH: list branches","gh:get_commit":()=>"GH: get commit","gh:issue_read":()=>e.issue_number?`GH: issue #${e.issue_number}`:"GH: read issue","gh:pull_request_read":()=>e.pullNumber?`GH: PR #${e.pullNumber}`:"GH: read PR","gh:actions_list":()=>"GH: list actions","gh:actions_get":()=>"GH: get action","gh:get_job_logs":()=>"GH: job logs"}[i];return o?o():i}var C=class extends HTMLElement{static get observedAttributes(){return["label","status","expanded"]}_init=!1;_linkedSection=null;connectedCallback(){this._init||(this._init=!0,this.classList.add("turn-chip","tool"),this.style.cursor="pointer",this.setAttribute("role","button"),this.setAttribute("tabindex","0"),this.setAttribute("aria-expanded","false"),this._render(),this.onclick=t=>{t.stopPropagation(),this._toggleExpand()},this.onkeydown=t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this._toggleExpand())})}_render(){let t=this.getAttribute("label")||"",i=this.getAttribute("status")||"running";this._resolveLink();let e=this._linkedSection?.getAttribute("params")||void 0,n=G(t,e),r=R(t),o=n.length>50?n.substring(0,47)+"\u2026":n;this.className=this.className.replace(/\bcat-\S+/g,"").trim(),this.classList.add("turn-chip","tool",`cat-${r}`);let a="";i==="running"?a='<span class="chip-spinner"></span> ':i==="failed"&&this.classList.add("failed"),this.innerHTML=a+d(o),n.length>50?this.dataset.tip=n:t!==n&&(this.dataset.tip=t),this.dataset.tip&&this.setAttribute("title",this.dataset.tip)}_resolveLink(){!this._linkedSection&&this.dataset.chipFor&&(this._linkedSection=document.getElementById(this.dataset.chipFor))}_toggleExpand(){this._resolveLink();let t=this._linkedSection;t&&(h(this.closest("chat-message"),this),t.classList.contains("turn-hidden")?(t.classList.remove("turn-hidden"),t.classList.add("chip-expanded"),this.style.opacity="0.5",this.setAttribute("aria-expanded","true")):(this.style.opacity="1",t.classList.add("collapsing"),setTimeout(()=>{t.classList.remove("collapsing","chip-expanded"),t.classList.add("turn-hidden")},250),this.setAttribute("aria-expanded","false")))}linkSection(t){this._linkedSection=t}attributeChangedCallback(t){this._init&&t==="status"&&this._render()}};var k=class extends HTMLElement{static get observedAttributes(){return["status"]}_init=!1;_linkedSection=null;connectedCallback(){this._init||(this._init=!0,this.classList.add("turn-chip"),this.style.cursor="pointer",this.setAttribute("role","button"),this.setAttribute("tabindex","0"),this.setAttribute("aria-expanded","false"),this._render(),this.onclick=t=>{t.stopPropagation(),this._toggleExpand()},this.onkeydown=t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this._toggleExpand())})}_render(){(this.getAttribute("status")||"complete")==="running"?this.innerHTML='<span class="chip-spinner"></span> \u{1F4AD} Thinking\u2026':this.textContent="\u{1F4AD} Thought"}attributeChangedCallback(t){this._init&&t==="status"&&this._render()}_resolveLink(){!this._linkedSection&&this.dataset.chipFor&&(this._linkedSection=document.getElementById(this.dataset.chipFor))}_toggleExpand(){this._resolveLink();let t=this._linkedSection;t&&(h(this.closest("chat-message"),this),t.classList.contains("turn-hidden")?(t.classList.remove("turn-hidden"),t.classList.add("chip-expanded"),this.style.opacity="0.5",this.setAttribute("aria-expanded","true")):(this.style.opacity="1",t.classList.add("collapsing"),setTimeout(()=>{t.classList.remove("collapsing","chip-expanded"),t.classList.add("turn-hidden")},250),this.setAttribute("aria-expanded","false")))}linkSection(t){this._linkedSection=t}};var E=class extends HTMLElement{static get observedAttributes(){return["label","status","color-index"]}_init=!1;_linkedSection=null;connectedCallback(){if(this._init)return;this._init=!0;let t=this.getAttribute("color-index")||"0";this.classList.add("turn-chip","subagent","subagent-c"+t),this.style.cursor="pointer",this.setAttribute("role","button"),this.setAttribute("tabindex","0"),this.setAttribute("aria-expanded","false"),this._render(),this.onclick=i=>{i.stopPropagation(),this._toggleExpand()},this.onkeydown=i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),this._toggleExpand())}}_render(){let t=this.getAttribute("label")||"",i=this.getAttribute("status")||"running",e=t.length>50?t.substring(0,47)+"\u2026":t,n="";i==="running"?n='<span class="chip-spinner"></span> ':i==="failed"&&this.classList.add("failed"),n+=t.length>50?"<span>"+e+"</span>":e,this.innerHTML=n}_resolveLink(){!this._linkedSection&&this.dataset.chipFor&&(this._linkedSection=document.getElementById(this.dataset.chipFor))}_toggleExpand(){this._resolveLink();let t=this._linkedSection;t&&(h(this.closest("chat-message"),this),t.classList.contains("turn-hidden")?(t.classList.remove("turn-hidden","collapsed"),t.classList.add("chip-expanded"),this.style.opacity="0.5",this.setAttribute("aria-expanded","true")):(this.style.opacity="1",t.classList.add("collapsing"),setTimeout(()=>{t.classList.remove("collapsing","chip-expanded"),t.classList.add("turn-hidden","collapsed")},250),this.setAttribute("aria-expanded","false")))}linkSection(t){this._linkedSection=t}attributeChangedCallback(t){this._init&&(t==="status"||t==="label")&&this._render()}};var x=class extends HTMLElement{static get observedAttributes(){return["disabled"]}_init=!1;connectedCallback(){this._init||(this._init=!0,this.classList.add("quick-replies"))}set options(t){this.innerHTML="",(t||[]).forEach(i=>{let e=document.createElement("button");e.type="button",e.className="quick-reply-btn",e.textContent=i,e.onclick=()=>{this.hasAttribute("disabled")||(this.setAttribute("disabled",""),this.dispatchEvent(new CustomEvent("quick-reply",{detail:{text:i},bubbles:!0})))},this.appendChild(e)})}attributeChangedCallback(t){t==="disabled"&&this.classList.toggle("disabled",this.hasAttribute("disabled"))}};var L=class extends HTMLElement{static get observedAttributes(){return["type","message"]}_init=!1;connectedCallback(){this._init||(this._init=!0,this._render())}_render(){let t=this.getAttribute("type")||"info",i=this.getAttribute("message")||"";this.className="status-row "+t;let e=t==="error"?"\u274C":"\u2139";this.textContent=e+" "+i}attributeChangedCallback(){this._init&&this._render()}};var A=class extends HTMLElement{static get observedAttributes(){return["timestamp"]}_init=!1;connectedCallback(){this._init||(this._init=!0,this.classList.add("session-sep"),this.setAttribute("role","separator"),this._render())}_render(){let t=this.getAttribute("timestamp")||"";this.setAttribute("aria-label","New session started "+t),this.innerHTML=`<span class="session-sep-line"></span><span class="session-sep-label"><span aria-hidden="true">\u{1F4C5} </span>New session \u2014 ${d(t)}</span><span class="session-sep-line"></span>`}attributeChangedCallback(){this._init&&this._render()}};var T=class extends HTMLElement{static get observedAttributes(){return["count","loading"]}_init=!1;connectedCallback(){this._init||(this._init=!0,this.classList.add("load-more-banner"),this.setAttribute("role","button"),this.setAttribute("tabindex","0"),this.setAttribute("aria-label","Load earlier messages"),this._render(),this.onclick=()=>{this.hasAttribute("loading")||(this.setAttribute("loading",""),this.dispatchEvent(new CustomEvent("load-more",{bubbles:!0})))},this.onkeydown=t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),this.click())})}_render(){let t=this.getAttribute("count")||"?",i=this.hasAttribute("loading");this.innerHTML=`<span class="load-more-text">${i?"Loading...":"\u25B2 Load earlier messages ("+t+" more) \u2014 click or scroll up"}</span>`}attributeChangedCallback(){this._init&&this._render()}};var S=class extends HTMLElement{_init=!1;connectedCallback(){this._init||(this._init=!0,this.classList.add("turn-details"))}};var O={_msgs(){return document.querySelector("#messages")},_container(){return document.querySelector("chat-container")},_thinkingCounter:0,_modelColors:{},_nextModelColor:0,_currentModel:"",_ctx:{},_getCtx(s,t){let i=s+"-"+t;return this._ctx[i]||(this._ctx[i]={msg:null,meta:null,details:null,textBubble:null,thinkingBlock:null}),this._ctx[i]},_ensureMsg(s,t){let i=this._getCtx(s,t);if(!i.msg){let e=document.createElement("chat-message");e.setAttribute("type","agent"),this._currentModel&&t==="main"&&(this._currentModel in this._modelColors||(this._modelColors[this._currentModel]=this._nextModelColor++%6),e.classList.add("model-c"+this._modelColors[this._currentModel]));let n=document.createElement("message-meta"),r=new Date,o=String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0"),a=document.createElement("span");a.className="ts",a.textContent=o,n.appendChild(a),e.appendChild(n);let l=document.createElement("turn-details");e.appendChild(l),this._msgs().appendChild(e),i.msg=e,i.meta=n,i.details=l}return i},_collapseThinkingFor(s){s?.thinkingBlock&&(s.thinkingBlock.removeAttribute("active"),s.thinkingBlock.removeAttribute("expanded"),s.thinkingBlock.classList.add("turn-hidden"),s.thinkingChip&&(s.thinkingChip.setAttribute("status","complete"),s.thinkingChip=null),s.thinkingBlock=null,s.thinkingMsg=null)},newSegment(s,t){let i=this._getCtx(s,t);if(i.textBubble){i.textBubble.removeAttribute("streaming");let e=i.textBubble.querySelector(".pending");e&&e.remove()}this._collapseThinkingFor(i),i.msg=null,i.meta=null,i.details=null,i.textBubble=null},addUserMessage(s,t,i){let e=document.createElement("chat-message");e.setAttribute("type","user");let n=document.createElement("message-meta");n.innerHTML='<span class="ts">'+t+"</span>"+(i||""),e.appendChild(n);let r=document.createElement("message-bubble");r.setAttribute("type","user"),r.textContent=s,e.appendChild(r),this._msgs().appendChild(e),this._container()?.forceScroll()},appendAgentText(s,t,i){try{let e=this._getCtx(s,t);if(this._collapseThinkingFor(e),!e.textBubble){if(!i.trim())return;let n=this._ensureMsg(s,t),r=document.createElement("message-bubble");r.setAttribute("streaming",""),n.msg.appendChild(r),n.textBubble=r}e.textBubble.appendStreamingText(i),this._container()?.scrollIfNeeded()}catch(e){console.error("[appendAgentText ERROR]",e.message,e.stack)}},finalizeAgentText(s,t,i){try{let e=this._getCtx(s,t);if(!e.textBubble&&!i)return;if(i)if(e.textBubble)e.textBubble.finalize(g(i));else{let n=this._ensureMsg(s,t),r=document.createElement("message-bubble");n.msg.appendChild(r),r.finalize(g(i))}else e.textBubble&&(e.textBubble.remove(),e.msg&&!e.msg.querySelector("message-bubble, tool-section, thinking-block")&&(e.msg.remove(),e.msg=null,e.meta=null));e.textBubble=null,this._container()?.scrollIfNeeded()}catch(e){console.error("[finalizeAgentText ERROR]",e.message,e.stack)}},addThinkingText(s,t,i){let e=this._ensureMsg(s,t);if(!e.thinkingBlock){this._thinkingCounter++;let n=document.createElement("thinking-block");n.id="think-"+this._thinkingCounter,n.setAttribute("active",""),n.setAttribute("expanded",""),e.details.appendChild(n),e.thinkingBlock=n;let r=document.createElement("thinking-chip");r.setAttribute("status","thinking"),r.dataset.chipFor=n.id,r.linkSection(n),e.meta.appendChild(r),e.meta.classList.add("show"),e.thinkingChip=r}e.thinkingBlock.appendText(i),this._container()?.scrollIfNeeded()},collapseThinking(s,t){let i=this._getCtx(s,t);this._collapseThinkingFor(i)},addToolCall(s,t,i,e,n){let r=this._ensureMsg(s,t);this._collapseThinkingFor(r);let o=document.createElement("tool-section");o.id=i,o.setAttribute("title",e),n&&o.setAttribute("params",n),r.details.appendChild(o);let a=document.createElement("tool-chip");a.setAttribute("label",e),a.setAttribute("status","running"),a.dataset.chipFor=i,a.linkSection(o),r.meta.appendChild(a),r.meta.classList.add("show"),this._container()?.scrollIfNeeded()},updateToolCall(s,t,i){let e=document.getElementById(s);if(e){let r=e.querySelector(".tool-result");r&&(r.innerHTML=typeof i=="string"?i:"Completed"),t==="failed"&&e.classList.add("failed")}let n=document.querySelector('[data-chip-for="'+s+'"]');n&&n.setAttribute("status",t==="failed"?"failed":"complete")},addSubAgent(s,t,i,e,n,r){let o=this._ensureMsg(s,t);this._collapseThinkingFor(o),o.textBubble=null;let a=document.createElement("subagent-chip");a.setAttribute("label",e),a.setAttribute("status","running"),a.setAttribute("color-index",String(n)),a.dataset.chipFor="sa-"+i,o.meta.appendChild(a),o.meta.classList.add("show");let l=document.createElement("message-bubble");l.innerHTML='<span class="subagent-prefix subagent-c'+n+'">@'+d(e)+"</span> "+d(r||""),o.msg.appendChild(l);let c=document.createElement("chat-message");c.setAttribute("type","agent"),c.id="sa-"+i,c.classList.add("subagent-indent","subagent-c"+n);let m=document.createElement("message-meta"),B=new Date,F=String(B.getHours()).padStart(2,"0")+":"+String(B.getMinutes()).padStart(2,"0"),H=document.createElement("span");H.className="ts",H.textContent=F,m.appendChild(H),c.appendChild(m);let D=document.createElement("turn-details");c.appendChild(D);let w=document.createElement("message-bubble");w.id="result-"+i,w.classList.add("subagent-result"),c.appendChild(w),this._msgs().appendChild(c),a.linkSection(c),this._container()?.scrollIfNeeded()},updateSubAgent(s,t,i){let e=document.getElementById("result-"+s);e&&(e.innerHTML=i||(t==="completed"?"Completed":'<span style="color:var(--error)">\u2716 Failed</span>'));let n=document.querySelector('[data-chip-for="sa-'+s+'"]');n&&n.setAttribute("status",t==="failed"?"failed":"complete"),this._container()?.scrollIfNeeded()},addSubAgentToolCall(s,t,i,e){let n=document.getElementById("sa-"+s);if(!n)return;let r=n.querySelector("message-meta"),o=document.createElement("tool-section");o.id=t,o.setAttribute("title",i),e&&o.setAttribute("params",e);let a=n.querySelector("turn-details");a?a.appendChild(o):n.appendChild(o);let l=document.createElement("tool-chip");l.setAttribute("label",i),l.setAttribute("status","running"),l.dataset.chipFor=t,l.linkSection(o),r&&(r.appendChild(l),r.classList.add("show")),this._container()?.scrollIfNeeded()},addError(s){let t=document.createElement("status-message");t.setAttribute("type","error"),t.setAttribute("message",s),this._msgs().appendChild(t),this._container()?.scrollIfNeeded()},addInfo(s){let t=document.createElement("status-message");t.setAttribute("type","info"),t.setAttribute("message",s),this._msgs().appendChild(t),this._container()?.scrollIfNeeded()},addSessionSeparator(s){let t=document.createElement("session-divider");t.setAttribute("timestamp",s),this._msgs().appendChild(t)},showPlaceholder(s){this.clear(),this._msgs().innerHTML='<div class="placeholder">'+d(s)+"</div>"},clear(){this._msgs().innerHTML="",this._ctx={},this._thinkingCounter=0,this._modelColors={},this._nextModelColor=0,this._currentModel=""},finalizeTurn(s,t){let i=this._ctx[s+"-main"];i?.textBubble&&!i.textBubble.textContent?.trim()&&i.textBubble.remove();let e=i?.meta??null;if(!e){let n=this._msgs().querySelectorAll('chat-message[type="agent"]:not(.subagent-indent)');n.length&&(e=n[n.length-1].querySelector("message-meta"))}if(t&&e){let n=typeof t=="string"?JSON.parse(t):t}i&&(i.thinkingBlock=null,i.textBubble=null),this._container()?.scrollIfNeeded(),this._trimMessages()},showPermissionRequest(s,t,i,e,n){this.disableQuickReplies();let r=this._ensureMsg(s,t);this._collapseThinkingFor(r);let o="perm-"+i,a=document.createElement("tool-section");a.id=o,a.setAttribute("title",e),n&&a.setAttribute("params",n),r.details.appendChild(a);let l=document.createElement("tool-chip");l.setAttribute("label",e),l.setAttribute("status","running"),l.dataset.chipFor=o,l.linkSection(a),r.meta.appendChild(l),r.meta.classList.add("show");let c=document.createElement("message-bubble");c.innerHTML=`Can I use <strong>${e}</strong>?`,r.msg.appendChild(c);let m=document.createElement("permission-request");m.setAttribute("req-id",i),r.msg.appendChild(m),this._container()?.scrollIfNeeded()},showQuickReplies(s){if(this.disableQuickReplies(),!s?.length)return;let t=document.createElement("quick-replies");t.options=s,this._msgs().appendChild(t),this._container()?.scrollIfNeeded()},disableQuickReplies(){document.querySelectorAll("quick-replies:not([disabled])").forEach(s=>s.setAttribute("disabled",""))},setPromptStats(s,t){let i=document.querySelectorAll(".prompt-row"),e=i[i.length-1];if(!e)return;let n=e.querySelector("message-meta");n||(n=document.createElement("message-meta"),e.insertBefore(n,e.firstChild)),n.classList.add("show");let r=document.createElement("span");r.className="turn-chip stats",r.textContent=t,r.dataset.tip=s,r.setAttribute("title",s),n.appendChild(r)},setCurrentModel(s){this._currentModel=s},restoreBatch(s){let t=g(s),i=document.createElement("div");i.innerHTML=t;let e=this._msgs(),n=e.firstChild;for(;i.firstChild;)n?e.insertBefore(i.firstChild,n):e.appendChild(i.firstChild)},showLoadMore(s){let t=document.querySelector("load-more");t||(t=document.createElement("load-more"),this._msgs().insertBefore(t,this._msgs().firstChild)),t.setAttribute("count",String(s)),t.removeAttribute("loading")},removeLoadMore(){document.querySelector("load-more")?.remove()},_trimMessages(){let s=this._msgs();if(!s)return;let t=Array.from(s.children).filter(i=>i.tagName==="CHAT-MESSAGE"||i.tagName==="STATUS-MESSAGE");if(t.length>80){let i=t.length-80;for(let n=0;n<i;n++)t[n].remove();let e=document.createElement("status-message");e.setAttribute("type","info"),e.setAttribute("message",`${i} older messages trimmed for performance`),s.insertBefore(e,s.firstChild)}}},q=O;var M=class extends HTMLElement{_init=!1;static get observedAttributes(){return["resolved"]}connectedCallback(){this._init||(this._init=!0,this._render())}_render(){let t=this.getAttribute("req-id")||"";this.className="perm-actions";let i=document.createElement("button");i.type="button",i.className="quick-reply-btn perm-allow",i.textContent="Allow",i.onclick=()=>this._respond(t,!0);let e=document.createElement("button");e.type="button",e.className="quick-reply-btn perm-deny",e.textContent="Deny",e.onclick=()=>this._respond(t,!1),this.appendChild(i),this.appendChild(e)}_respond(t,i){this.querySelectorAll("button").forEach(o=>o.disabled=!0);let e="perm-"+t,n=document.querySelector(`[data-chip-for="${e}"]`);n&&n.setAttribute("status",i?"complete":"failed");let r=document.createElement("div");r.className="perm-result "+(i?"perm-allowed":"perm-denied"),r.textContent=i?"\u2713 Allowed":"\u2717 Denied",this.replaceChildren(r),globalThis._bridge?.permissionResponse(`${t}:${i}`)}};customElements.define("chat-container",p);customElements.define("chat-message",_);customElements.define("message-bubble",b);customElements.define("message-meta",f);customElements.define("thinking-block",v);customElements.define("tool-section",y);customElements.define("tool-chip",C);customElements.define("thinking-chip",k);customElements.define("subagent-chip",E);customElements.define("quick-replies",x);customElements.define("status-message",L);customElements.define("session-divider",A);customElements.define("load-more",T);customElements.define("turn-details",S);customElements.define("permission-request",M);window.ChatController=q;window.b64=g;window.showPermissionRequest=(s,t,i,e,n)=>{q.showPermissionRequest(s,t,i,e,n)};document.addEventListener("click",s=>{let t=s.target;for(;t&&t.tagName!=="A";)t=t.parentElement;if(!t?.getAttribute("href"))return;let i=t.getAttribute("href");i.startsWith("openfile://")?(s.preventDefault(),globalThis._bridge?.openFile(i)):(i.startsWith("http://")||i.startsWith("https://"))&&(s.preventDefault(),globalThis._bridge?.openUrl(i))});var N="";document.addEventListener("mouseover",s=>{let t=s.target,i="default";t.closest("a,.turn-chip,.chip-close,.prompt-ctx-chip,.quick-reply-btn")?i="pointer":t.closest("p,pre,code,li,td,th,.thinking-content,.streaming")&&(i="text"),i!==N&&(N=i,globalThis._bridge?.setCursor(i))});document.addEventListener("quick-reply",s=>{globalThis._bridge?.quickReply(s.detail.text)});document.addEventListener("load-more",()=>{globalThis._bridge?.loadMore()});})();
